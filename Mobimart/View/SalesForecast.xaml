<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MobiMart.View.SalesForecast"
             xmlns:viewmodel="clr-namespace:MobiMart.ViewModel"
             x:DataType="viewmodel:SalesForecastViewModel"
             xmlns:microcharts="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             xmlns:model="clr-namespace:MobiMart.Model"
             Title="SalesForecast"
             BackgroundColor="#FFFBE9">

    <Grid RowDefinitions="Auto, *" ColumnDefinitions="*">

        <!-- Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="15" Spacing="20">

                <!-- Forecast Header -->
                <Label Text="Forecast for this Month"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       TextColor="Black"/>

                <!-- Bar Chart -->
                <Border Padding="15" Stroke="#BFA76F" StrokeThickness="1" 
                    HeightRequest="220">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="10"/>
                    </Border.StrokeShape>
                        <microcharts:ChartView 
                            x:Name="PieChartController"
                            Chart="{Binding BarChart}"/>
                </Border>

                <!-- Forecasted Revenue -->
                <Label FontSize="16" TextColor="Black">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="Forecasted Revenue: " FontAttributes="Bold" TextColor="Black"/>
                            <Span Text="{Binding ForecastedRevenue}" FontAttributes="Italic" TextColor="Black"/>

                            <Span Text=" â“˜" TextColor="Black" FontAttributes="Bold">
                                <Span.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnInfoClicked"/>
                                </Span.GestureRecognizers>
                            </Span>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>

                <!-- Current Revenue -->
                <Label FontSize="16" TextColor="Black">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="Current Revenue: " FontAttributes="Bold" TextColor="Black"/>
                            <Span Text="{Binding CurrentRevenue}" FontAttributes="Italic" TextColor="Black"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>

                <!-- Recommendations Header -->
                <Label Text="Sales Forecasting Recommendations"
                       FontAttributes="Bold"
                       FontSize="16"
                       HorizontalOptions="Center"
                       TextColor="#5A420B"/>

                <ActivityIndicator IsRunning="False" 
                            IsVisible="False"
                            Color="#D99B2B" 
                            VerticalOptions="Center" 
                            HorizontalOptions="Center">
                    <ActivityIndicator.Triggers>
                        <DataTrigger TargetType="ActivityIndicator" Binding="{Binding SalesRecommendations.Count}" Value="0">
                            <Setter Property="IsVisible" Value="True"/>
                            <Setter Property="IsRunning" Value="True"/>
                        </DataTrigger>
                    </ActivityIndicator.Triggers>
                </ActivityIndicator>

                <!-- Recommendations Box -->
                <CollectionView ItemsSource="{Binding SalesRecommendations}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="model:SalesRecommendation">
                            <Frame BorderColor="#E6B655"
                                BackgroundColor="#FFF9EF"
                                CornerRadius="8"
                                Padding="10"
                                HasShadow="False">
                                <VerticalStackLayout Spacing="5">
                                    <Label Text="{Binding Title}"
                                        FontAttributes="Bold"
                                        FontSize="14"
                                        TextColor="Black"/>
                                    <Label Text="{Binding Details}"
                                        FontSize="13"
                                        TextColor="Black"/>
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>