<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MobiMart.View.IncomeSummary"
             xmlns:microcharts="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             xmlns:viewmodel="clr-namespace:MobiMart.ViewModel"
             x:DataType="viewmodel:DailySalesViewModel"
             xmlns:model="clr-namespace:MobiMart.Model"
             Title="IncomeSummary"
             BackgroundColor="#FFFBE9">

    <ScrollView Padding="20">
        <VerticalStackLayout Spacing="20">

            <!-- Today's Income placeholder -->
            <Label Text="{Binding TodaysIncome, StringFormat='Today\'s Income: â‚±{0:0.00}'}"
                    FontAttributes="Bold" 
                    FontSize="18" 
                    TextColor="#7A5C1A"/>

            <!-- Pie Chart -->
            <Border Padding="10" Stroke="LightGray" StrokeThickness="1"
                    HeightRequest="200" WidthRequest="350">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10"/>
                </Border.StrokeShape>
                <Border.Triggers>
                    <DataTrigger TargetType="Border" Binding="{Binding HasNoTransactions}" Value="True">
                        <Setter Property="IsVisible" Value="False"/>
                    </DataTrigger>
                </Border.Triggers>
                    <microcharts:ChartView 
                        x:Name="PieChartController"
                        Chart="{Binding PieChart}"/>
            </Border>
            <Border Padding="10" Stroke="LightGray" StrokeThickness="1"
                    HeightRequest="200" WidthRequest="350"
                    IsVisible="{Binding HasNoTransactions}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10"/>
                </Border.StrokeShape>
                <Label Text="seems like no transaction has been made today"
                            FontSize="16"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            HorizontalTextAlignment="Center"/>
            </Border>

            <!-- Table title -->
            <Label Text="Items Sold Today"
                    FontAttributes="Bold"
                    FontSize="18"
                    TextColor="#7A5C1A"/>

            <!-- Table with Borders -->
            <CollectionView ItemsSource="{Binding ItemsSold}">
                <CollectionView.Header>
                    <Grid ColumnDefinitions="*, *, *" Padding="5" BackgroundColor="#C07A2A">
                        <Label Text="Item Name" Grid.Column="0" TextColor="White"/>
                        <Label Text="Amount Sold" Grid.Column="1" TextColor="White" HorizontalTextAlignment="Center"/>
                        <Label Text="Total Price" Grid.Column="2" TextColor="White" HorizontalTextAlignment="Center"/>
                        <!-- <Label Text="Date Sold" Grid.Column="3" TextColor="White" HorizontalTextAlignment="Center"/>
                        <Label Text="Item Type" Grid.Column="4" TextColor="White" HorizontalTextAlignment="Center"/> -->
                    </Grid>
                </CollectionView.Header>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodel:ItemSold">
                        <VerticalStackLayout Spacing="0">
                            <Grid ColumnDefinitions="*, *, *" Padding="5" BackgroundColor="#D9B76E">
                                <Label Text="{Binding ItemName}" Grid.Column="0" />
                                <Label Text="{Binding Amount}" Grid.Column="1"  HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Total}" Grid.Column="2"  HorizontalTextAlignment="Center"/>
                                <!-- <Label Text="{Binding Date}" Grid.Column="3" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding ItemType}" Grid.Column="4" HorizontalTextAlignment="Center"/> -->
                            </Grid>
                            <!-- Row Separator -->
                            <BoxView HeightRequest="1" Color="#C07A2A"/>
                        </VerticalStackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>