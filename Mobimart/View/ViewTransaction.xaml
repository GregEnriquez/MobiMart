<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:view="clr-namespace:MobiMart.View"
             x:Class="MobiMart.View.ViewTransaction"
             xmlns:viewmodel="clr-namespace:MobiMart.ViewModel"
             x:DataType="viewmodel:ViewTransactionViewModel"
             xmlns:model="clr-namespace:MobiMart.Model"
             BackgroundColor="#FDF4DC"
             Title="ViewTransaction">


    <Grid RowDefinitions="Auto, Auto, *, Auto" Padding="10">

        <!-- Page Header -->
        <Label Grid.Row="0" 
               Text="Transaction Details"
               HorizontalOptions="Center"
               VerticalOptions="Center"
               TextColor="#6D5206"
               FontSize="18"
               FontAttributes="Bold"
               Padding="10"/>

        <!-- Transaction Items List -->
        <Frame Grid.Row="1"
               BackgroundColor="#F6CD5E"
               CornerRadius="10"
               Padding="10"
               Margin="0"
               BorderColor="#6D5206"
               VerticalOptions="FillAndExpand">

            <Grid RowDefinitions="Auto, *" VerticalOptions="FillAndExpand">

                <StackLayout Grid.Row="0" Spacing="10">
                    <Label Text="Transaction List"
                           FontAttributes="Bold"
                           FontSize="16"
                           TextColor="#6D5206"/>
                    <BoxView HeightRequest="1" BackgroundColor="#6D5206" VerticalOptions="End" />
                    <Grid ColumnDefinitions="100, *, *" Padding="0">
                        <Label Text="Item Name" TextColor="#6D5206" FontAttributes="Bold" />
                        <Label Grid.Column="1" Text="Quantity" TextColor="#6D5206" FontAttributes="Bold" HorizontalOptions="Center"/>
                        <Label Grid.Column="2" Text="Price" TextColor="#6D5206" FontAttributes="Bold" HorizontalOptions="Center"/>
                    </Grid>
                    <BoxView HeightRequest="1" BackgroundColor="#6D5206" VerticalOptions="End" />
                </StackLayout>

                <CollectionView Grid.Row="1"
                                Margin="0,5,0,0"
                                ItemsSource="{Binding Record.Items}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="model:SalesItem">
                            <Grid ColumnDefinitions="Auto, *">
                                <CheckBox IsVisible="{Binding BindingContext.IsReturning, Source={RelativeSource AncestorType={x:Type ContentPage}}}">
                                    <CheckBox.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnCheckboxClicked"/>
                                    </CheckBox.GestureRecognizers>
                                </CheckBox>
                                <Grid Grid.Column="1" ColumnDefinitions="100, *, *" Padding="5" ColumnSpacing="5">
                                    <Grid.Triggers>
                                        <DataTrigger TargetType="Grid" Binding="{Binding IsDeleted}" Value="True">
                                            <Setter Property="IsVisible" Value="False"/>
                                        </DataTrigger>
                                    </Grid.Triggers>
                                    <Border Stroke="#6D5206" 
                                            StrokeThickness="1" 
                                            StrokeShape="RoundRectangle 5,5,5,5"
                                            Padding="3">
                                        <Label Text="{Binding Name}" 
                                            TextColor="#6D5206" 
                                            VerticalOptions="Center"/>
                                    </Border>
                                    <Border Stroke="#6D5206" 
                                            StrokeThickness="1" 
                                            StrokeShape="RoundRectangle 5,5,5,5"
                                            Padding="3"
                                            Grid.Column="1">
                                        <Label Text="{Binding Quantity}" 
                                            TextColor="#6D5206" 
                                            HorizontalOptions="Center"
                                            VerticalOptions="Center"/>
                                    </Border>
                                    <Border Stroke="#6D5206" 
                                            StrokeThickness="1" 
                                            StrokeShape="RoundRectangle 5,5,5,5"
                                            Padding="3"
                                            Grid.Column="2">
                                        <Label Text="{Binding Price}" 
                                            TextColor="#6D5206" 
                                            HorizontalOptions="Center"
                                            VerticalOptions="Center"/>
                                    </Border>
                                </Grid>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </Frame>

        <StackLayout Grid.Row="2"
                     Margin="10,10,0,0"
                     Spacing="5"
                     HorizontalOptions="Start">

            <Label x:Name="TotalLabel"
                   Text="{Binding Record.TotalPrice, StringFormat='Total: ₱{0:F2}'}"
                   FontSize="16"
                   FontAttributes="Bold"
                   TextColor="#6D5206"/>

            <Label x:Name="PaymentLabel"
                   Text="{Binding Record.Payment, StringFormat='Payment: ₱{0:F2}'}"
                   FontSize="16"
                   FontAttributes="Bold"
                   TextColor="#6D5206"/>

            <Label x:Name="ChangeLabel"
                   Text="{Binding Record.Change, StringFormat='Change: ₱{0:F2}'}"
                   FontSize="16"
                   FontAttributes="Bold"
                   TextColor="#6D5206"/>
        </StackLayout>

        <StackLayout Grid.Row="3" Spacing="0" Padding="20,0">
            <Button
                    Text="Return Item"
                    TextColor="#6D5206"
                    BackgroundColor="#FBE7B3"
                    BorderColor="#6D5206"
                    BorderWidth="2"
                    CornerRadius="20"
                    HeightRequest="40"
                    HorizontalOptions="Center"
                    VerticalOptions="End"
                    WidthRequest="200"
                    Margin="0,5,0,5"
                    Command="{Binding Button1ClickedCommand}">
            <Button.Triggers>
                <DataTrigger TargetType="Button"
                            Binding="{Binding IsReturning}"
                            Value="True">
                    <Setter Property="Text" Value="Confirm"/>
                </DataTrigger>
            </Button.Triggers>
            </Button>
            
            <Button
                    Text="Void"
                    TextColor="#6D5206"
                    BackgroundColor="#FBE7B3"
                    BorderColor="#6D5206"
                    BorderWidth="2"
                    CornerRadius="20"
                    HeightRequest="40"
                    HorizontalOptions="Center"
                    VerticalOptions="End"
                    WidthRequest="200"
                    Margin="0,5,0,5"
                    Command="{Binding Button2ClickedCommand}">
            <Button.Triggers>
                <DataTrigger TargetType="Button"
                            Binding="{Binding IsReturning}"
                            Value="True">
                    <Setter Property="Text" Value="Cancel"/>
                </DataTrigger>
            </Button.Triggers>
            </Button>
        </StackLayout>
    </Grid>
</ContentPage>